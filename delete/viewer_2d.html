<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>DXF JSON Viewer (Fit)</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      background: #fafafa;
    }
    canvas {
      width: 100%;
      height: 100%;
      display: block;
    }
  </style>
</head>
<body>
<canvas id="cv"></canvas>

<script>
async function main() {
  const json = await fetch("Drawing1.json").then(r => r.json());
  const canvas = document.getElementById("cv");
  const ctx = canvas.getContext("2d");

  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;

  // ---- 1. 모든 점의 최소/최대값 계산(바운딩 박스) ----
  let minX = Infinity, maxX = -Infinity;
  let minY = Infinity, maxY = -Infinity;

  function updateBounds(x, y) {
    if (x < minX) minX = x;
    if (x > maxX) maxX = x;
    if (y < minY) minY = y;
    if (y > maxY) maxY = y;
  }

  const layers = json.layers;
  Object.keys(layers).forEach(layer => {
    layers[layer].forEach(e => {
      if (e.type === "LINE") {
        updateBounds(e.start[0], e.start[1]);
        updateBounds(e.end[0], e.end[1]);
      } else if (e.type === "LWPOLYLINE") {
        e.points.forEach(p => updateBounds(p[0], p[1]));
      }
    });
  });

  const width = maxX - minX;
  const height = maxY - minY;

  // 여백
  const margin = 20;

  // ---- 2. 화면에 맞는 스케일 계산 ----
  const scaleX = (canvas.width  - margin * 2) / width;
  const scaleY = (canvas.height - margin * 2) / height;
  const scale = Math.min(scaleX, scaleY);

  // Y축 뒤집기 + 평행이동
  function toCanvas(x, y) {
    const nx = (x - minX) * scale + margin;
    const ny = canvas.height - ((y - minY) * scale + margin); // 위/아래 뒤집기
    return [nx, ny];
  }

  // ---- 3. 그리기 ----
  ctx.strokeStyle = "#333";
  ctx.lineWidth = 1;

  Object.keys(layers).forEach(layer => {
    layers[layer].forEach(e => {
      if (e.type === "LINE") {
        const [x1, y1] = toCanvas(e.start[0], e.start[1]);
        const [x2, y2] = toCanvas(e.end[0], e.end[1]);
        ctx.beginPath();
        ctx.moveTo(x1, y1);
        ctx.lineTo(x2, y2);
        ctx.stroke();
      } else if (e.type === "LWPOLYLINE") {
        const pts = e.points;
        if (pts.length < 2) return;
        ctx.beginPath();
        const [sx, sy] = toCanvas(pts[0][0], pts[0][1]);
        ctx.moveTo(sx, sy);
        for (let i = 1; i < pts.length; i++) {
          const [x, y] = toCanvas(pts[i][0], pts[i][1]);
          ctx.lineTo(x, y);
        }
        ctx.stroke();
      }
    });
  });

  console.log("minX, maxX, minY, maxY:", minX, maxX, minY, maxY);
}

main();
</script>
</body>
</html>
